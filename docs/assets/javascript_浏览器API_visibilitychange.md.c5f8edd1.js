import{_ as s,c as n,o as a,a as l}from"./app.fbd6e7ea.js";const u=JSON.parse('{"title":"","description":"","frontmatter":{},"headers":[],"relativePath":"javascript/浏览器API/visibilitychange.md","lastUpdated":1690788699000}'),p={name:"javascript/浏览器API/visibilitychange.md"},e=l(`<h4 id="当浏览器标签页隐藏、显示等会触发该事件" tabindex="-1">当浏览器标签页隐藏、显示等会触发该事件 <a class="header-anchor" href="#当浏览器标签页隐藏、显示等会触发该事件" aria-hidden="true">#</a></h4><div class="language-js line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki dark-plus" tabindex="0"><code><span class="line"><span style="color:#9CDCFE;">document</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">addEventListener</span><span style="color:#D4D4D4;">(</span><span style="color:#CE9178;">&quot;visibilitychange&quot;</span><span style="color:#D4D4D4;">, </span><span style="color:#569CD6;">function</span><span style="color:#D4D4D4;">() {</span></span>
<span class="line"><span style="color:#D4D4D4;">  </span><span style="color:#C586C0;">if</span><span style="color:#D4D4D4;"> (</span><span style="color:#9CDCFE;">document</span><span style="color:#D4D4D4;">.</span><span style="color:#9CDCFE;">visibilityState</span><span style="color:#D4D4D4;"> === </span><span style="color:#CE9178;">&#39;visible&#39;</span><span style="color:#D4D4D4;">) {</span></span>
<span class="line"><span style="color:#D4D4D4;">    </span><span style="color:#6A9955;">// 显示的时候可以打开计时器</span></span>
<span class="line"><span style="color:#D4D4D4;">  } </span><span style="color:#C586C0;">else</span><span style="color:#D4D4D4;"> {</span></span>
<span class="line"><span style="color:#D4D4D4;">    </span><span style="color:#6A9955;">// 隐藏的时候清除计时器</span></span>
<span class="line"><span style="color:#D4D4D4;">  }</span></span>
<span class="line"><span style="color:#D4D4D4;">});</span></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><div class="jingao"><p>警告： 当 visibleStateState 属性的值转换为 hidden 时，Safari 不会按预期触发 visibilitychange；</p><p>因此，在这种情况下，您还需要包含代码以侦听 pagehide 事件</p></div><div class="jingao"><p>警告： 出于兼容性原因，请确保使用 document.addEventListener 而不是 window.addEventListener</p><p>来注册回调。Safari &lt;14.0 仅支持前者</p></div><h4 id="例如在vue3中使用" tabindex="-1">例如在vue3中使用 <a class="header-anchor" href="#例如在vue3中使用" aria-hidden="true">#</a></h4><div class="language-ts line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">ts</span><pre class="shiki dark-plus" tabindex="0"><code><span class="line"><span style="color:#DCDCAA;">onMounted</span><span style="color:#D4D4D4;">(</span><span style="color:#569CD6;">async</span><span style="color:#D4D4D4;"> () </span><span style="color:#569CD6;">=&gt;</span><span style="color:#D4D4D4;"> {</span></span>
<span class="line"><span style="color:#D4D4D4;">  </span><span style="color:#DCDCAA;">watchEffect</span><span style="color:#D4D4D4;">(</span><span style="color:#569CD6;">async</span><span style="color:#D4D4D4;"> (</span><span style="color:#9CDCFE;">clearnup</span><span style="color:#D4D4D4;">) </span><span style="color:#569CD6;">=&gt;</span><span style="color:#D4D4D4;"> {</span></span>
<span class="line"><span style="color:#D4D4D4;">    </span><span style="color:#DCDCAA;">clearnup</span><span style="color:#D4D4D4;">(() </span><span style="color:#569CD6;">=&gt;</span><span style="color:#D4D4D4;"> {</span></span>
<span class="line"><span style="color:#D4D4D4;">      </span><span style="color:#6A9955;">// 页面卸载清除所有事件</span></span>
<span class="line"><span style="color:#D4D4D4;">      </span><span style="color:#9CDCFE;">document</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">removeEventListener</span><span style="color:#D4D4D4;">(</span><span style="color:#CE9178;">&#39;visibilitychange&#39;</span><span style="color:#D4D4D4;">, </span><span style="color:#9CDCFE;">visibilityStateFun</span><span style="color:#D4D4D4;">)</span></span>
<span class="line"><span style="color:#D4D4D4;">      </span><span style="color:#9CDCFE;">window</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">removeEventListener</span><span style="color:#D4D4D4;">(</span><span style="color:#CE9178;">&#39;pagehide&#39;</span><span style="color:#D4D4D4;">, </span><span style="color:#9CDCFE;">pagehideFun</span><span style="color:#D4D4D4;">)</span></span>
<span class="line"><span style="color:#D4D4D4;">    })</span></span>
<span class="line"><span style="color:#D4D4D4;">  })</span></span>
<span class="line"><span style="color:#D4D4D4;">  </span><span style="color:#6A9955;">/**</span></span>
<span class="line"><span style="color:#6A9955;">   * 浏览器本着节省内存的性质，当切换到其他页面时，</span></span>
<span class="line"><span style="color:#6A9955;">   * 页面的定时器会延时执行，当切换回来的时候被延时执行的动画会一次依次执行，</span></span>
<span class="line"><span style="color:#6A9955;">   * 这样我们就会看到动画加速运动，出现错误，在轮播图之类的页面经常会发生这样的情况</span></span>
<span class="line"><span style="color:#6A9955;">   * 所说在浏览器不可见时关闭计时器</span></span>
<span class="line"><span style="color:#6A9955;">   */</span></span>
<span class="line"><span style="color:#D4D4D4;">  </span><span style="color:#9CDCFE;">document</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">addEventListener</span><span style="color:#D4D4D4;">(</span><span style="color:#CE9178;">&#39;visibilitychange&#39;</span><span style="color:#D4D4D4;">, </span><span style="color:#9CDCFE;">visibilityStateFun</span><span style="color:#D4D4D4;">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D4D4D4;">  </span><span style="color:#6A9955;">// 当visibleStateState 属性的值转换为 hidden 时，Safari 不会按预期触发,要用来监听,兼容Safari</span></span>
<span class="line"><span style="color:#D4D4D4;">  </span><span style="color:#9CDCFE;">window</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">addEventListener</span><span style="color:#D4D4D4;">(</span><span style="color:#CE9178;">&#39;pagehide&#39;</span><span style="color:#D4D4D4;">, </span><span style="color:#9CDCFE;">pagehideFun</span><span style="color:#D4D4D4;">)</span></span>
<span class="line"><span style="color:#D4D4D4;">})</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A9955;">// visibilitychangea 事件</span></span>
<span class="line"><span style="color:#569CD6;">const</span><span style="color:#D4D4D4;"> </span><span style="color:#DCDCAA;">visibilityStateFun</span><span style="color:#D4D4D4;"> = () </span><span style="color:#569CD6;">=&gt;</span><span style="color:#D4D4D4;"> {</span></span>
<span class="line"><span style="color:#D4D4D4;">  </span><span style="color:#C586C0;">if</span><span style="color:#D4D4D4;"> (</span><span style="color:#9CDCFE;">document</span><span style="color:#D4D4D4;">.</span><span style="color:#9CDCFE;">visibilityState</span><span style="color:#D4D4D4;"> == </span><span style="color:#CE9178;">&#39;visible&#39;</span><span style="color:#D4D4D4;">) {</span></span>
<span class="line"><span style="color:#D4D4D4;">    </span><span style="color:#DCDCAA;">pubFun</span><span style="color:#D4D4D4;">() </span><span style="color:#6A9955;">// 网页是可见或者是部分可见重启计时器</span></span>
<span class="line"><span style="color:#D4D4D4;">  } </span><span style="color:#C586C0;">else</span><span style="color:#D4D4D4;"> {</span></span>
<span class="line"><span style="color:#D4D4D4;">    </span><span style="color:#DCDCAA;">clearTimeFun</span><span style="color:#D4D4D4;">() </span><span style="color:#6A9955;">// 网页不可见关闭计时器</span></span>
<span class="line"><span style="color:#D4D4D4;">  }</span></span>
<span class="line"><span style="color:#D4D4D4;">}</span></span>
<span class="line"><span style="color:#6A9955;">// pagehide 事件,兼容Safari</span></span>
<span class="line"><span style="color:#569CD6;">const</span><span style="color:#D4D4D4;"> </span><span style="color:#DCDCAA;">pagehideFun</span><span style="color:#D4D4D4;"> = () </span><span style="color:#569CD6;">=&gt;</span><span style="color:#D4D4D4;"> {</span></span>
<span class="line"><span style="color:#D4D4D4;">  </span><span style="color:#DCDCAA;">clearTimeFun</span><span style="color:#D4D4D4;">() </span><span style="color:#6A9955;">// 网页不可见关闭计时器</span></span>
<span class="line"><span style="color:#D4D4D4;">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br></div></div><p>详情点击<a href="https://developer.mozilla.org/zh-CN/docs/Web/API/Document/visibilitychange_event">MDN</a></p>`,7),o=[e];function c(r,D,t,i,y,b){return a(),n("div",null,o)}const C=s(p,[["render",c]]);export{u as __pageData,C as default};
